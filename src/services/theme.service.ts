import { Injectable, signal, computed, effect } from '@angular/core';

export interface ColorPalette {
  [key: string]: string;
}

export interface Theme {
  name: string;
  palette: ColorPalette;
}

@Injectable({
  providedIn: 'root',
})
export class ThemeService {
  private themes: Theme[] = [
    {
      name: 'blue',
      palette: {
        '50': '239 246 255', '100': '219 234 254', '200': '191 219 254',
        '300': '147 197 253', '400': '96 165 250', '500': '59 130 246',
        '600': '37 99 235', '700': '29 78 216', '800': '30 64 175',
        '900': '30 58 138', '950': '23 37 84',
      },
    },
    {
      name: 'indigo',
      palette: {
        '50': '238 242 255', '100': '224 231 255', '200': '199 210 254',
        '300': '165 180 252', '400': '129 140 248', '500': '99 102 241',
        '600': '79 70 229', '700': '67 56 202', '800': '55 48 163',
        '900': '49 46 129', '950': '30 27 75',
      },
    },
    {
      name: 'green',
      palette: {
        '50': '240 253 244', '100': '220 252 231', '200': '187 247 208',
        '300': '134 239 172', '400': '74 222 128', '500': '34 197 94',
        '600': '22 163 74', '700': '21 128 61', '800': '22 101 52',
        '900': '20 83 45', '950': '5 46 22',
      },
    },
    {
      name: 'rose',
      palette: {
        '50': '255 241 242', '100': '255 228 230', '200': '254 205 211',
        '300': '253 164 175', '400': '251 113 133', '500': '244 63 94',
        '600': '225 29 72', '700': '190 18 60', '800': '159 18 57',
        '900': '136 19 55', '950': '76 5 25',
      },
    },
    {
      name: 'red',
      palette: {
        '50': '254 242 242', '100': '254 226 226', '200': '254 202 202',
        '300': '252 165 165', '400': '248 113 113', '500': '239 68 68',
        '600': '220 38 38', '700': '185 28 28', '800': '153 27 27',
        '900': '127 29 29', '950': '69 10 10',
      },
    },
    {
      name: 'orange',
      palette: {
        '50': '255 247 237', '100': '255 237 213', '200': '254 215 170',
        '300': '253 186 116', '400': '251 146 60', '500': '249 115 22',
        '600': '234 88 12', '700': '194 65 12', '800': '154 52 18',
        '900': '124 45 18', '950': '67 20 7',
      },
    },
    {
      name: 'amber',
      palette: {
        '50': '255 251 235', '100': '254 243 199', '200': '253 230 138',
        '300': '252 211 77', '400': '251 191 36', '500': '245 158 11',
        '600': '217 119 6', '700': '180 83 9', '800': '146 64 14',
        '900': '120 53 15', '950': '66 28 8',
      },
    },
    {
      name: 'teal',
      palette: {
        '50': '240 253 250', '100': '204 251 241', '200': '167 243 235',
        '300': '107 231 212', '400': '45 212 191', '500': '20 184 166',
        '600': '13 148 136', '700': '15 118 110', '800': '17 94 89',
        '900': '19 78 74', '950': '4 47 46',
      },
    },
    {
      name: 'purple',
      palette: {
        '50': '250 245 255', '100': '243 232 255', '200': '233 213 255',
        '300': '216 180 254', '400': '192 132 252', '500': '168 85 247',
        '600': '147 51 234', '700': '126 34 206', '800': '107 33 168',
        '900': '88 28 135', '950': '59 7 100',
      },
    },
    {
      name: 'pink',
      palette: {
        '50': '253 242 248', '100': '252 231 243', '200': '251 207 232',
        '300': '249 168 212', '400': '244 114 182', '500': '236 72 153',
        '600': '219 39 119', '700': '190 24 93', '800': '157 23 77',
        '900': '131 24 67', '950': '83 7 43',
      },
    },
    {
      name: 'cyan',
      palette: {
        '50': '236 254 255', '100': '207 250 254', '200': '165 243 252',
        '300': '103 232 249', '400': '34 211 238', '500': '6 182 212',
        '600': '8 145 178', '700': '14 116 144', '800': '21 94 117',
        '900': '22 78 99', '950': '8 47 73',
      },
    },
    {
      name: 'lime',
      palette: {
        '50': '247 254 231', '100': '236 252 203', '200': '217 249 157',
        '300': '190 242 100', '400': '163 230 53', '500': '132 204 22',
        '600': '101 163 13', '700': '77 124 15', '800': '63 98 18',
        '900': '54 83 20', '950': '24 39 12',
      },
    },
    {
      name: 'stone',
      palette: {
        '50': '250 250 249', '100': '245 245 244', '200': '231 229 228',
        '300': '214 211 209', '400': '168 162 158', '500': '120 113 108',
        '600': '87 83 78', '700': '68 64 60', '800': '41 37 36',
        '900': '28 25 23', '950': '12 10 9',
      },
    },
    {
      name: 'violet',
      palette: {
        '50': '245 243 255', '100': '237 233 254', '200': '221 214 254',
        '300': '196 181 253', '400': '167 139 250', '500': '139 92 246',
        '600': '124 58 237', '700': '109 40 217', '800': '91 33 182',
        '900': '76 29 149', '950': '46 16 101',
      },
    },
  ];

  availableThemes = signal<Theme[]>(this.themes);
  
  currentThemeName = signal<string>(this.getInitialTheme());

  activeTheme = computed(() => {
    const activeName = this.currentThemeName();
    return this.themes.find(t => t.name === activeName) || this.themes[0];
  });

  themeCssVariables = computed(() => {
    const palette = this.activeTheme().palette;
    const variables: { [key: string]: string } = {};
    for (const shade in palette) {
      variables[`--primary-${shade}`] = palette[shade];
    }
    return variables;
  });

  constructor() {
    effect(() => {
      if (typeof window !== 'undefined' && window.localStorage) {
        localStorage.setItem('app-theme', this.currentThemeName());
      }
    });
  }

  private getInitialTheme(): string {
    if (typeof window !== 'undefined' && window.localStorage) {
      return localStorage.getItem('app-theme') || 'blue';
    }
    return 'blue';
  }

  setTheme(themeName: string) {
    this.currentThemeName.set(themeName);
  }
}
