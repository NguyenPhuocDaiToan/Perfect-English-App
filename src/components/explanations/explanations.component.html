<!-- Hero Section -->
<section class="bg-gradient-to-br from-primary-50 via-white to-blue-100">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
    <h1 class="text-4xl font-extrabold tracking-tight text-slate-900 sm:text-5xl">Learning Library</h1>
    <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">Explore clear explanations and examples for every area of English.</p>
  </div>
</section>

<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Filter Bar -->
  <div class="border-b border-slate-200 mb-8">
    <nav class="-mb-px flex justify-center space-x-6 overflow-x-auto" aria-label="Tabs">
      @for (category of categories; track category) {
        <button
          (click)="selectCategory(category)"
          [class]="selectedCategory() === category
            ? 'border-primary-500 text-primary-600'
            : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'"
          class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
          {{ category }}
        </button>
      }
    </nav>
  </div>

  @if (status() === 'loading') {
    <div class="space-y-4 max-w-5xl mx-auto animate-pulse">
      @for (item of [1,2,3,4,5]; track item) {
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
           <div class="flex flex-col sm:flex-row gap-5 items-start">
              <div class="flex-shrink-0 bg-slate-200 p-3.5 rounded-lg h-[52px] w-[52px]"></div>
              <div class="flex-1 w-full">
                <div class="h-5 bg-slate-300 rounded w-1/3 mb-2"></div>
                <div class="h-4 bg-slate-200 rounded w-2/3"></div>
              </div>
            </div>
        </div>
      }
    </div>
  } @else if (status() === 'loaded' && topics().length > 0) {
    <div class="space-y-4 max-w-5xl mx-auto">
      <!-- Loop through each topic -->
      @for (topic of topics(); track topic.id) {
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all duration-300 hover:shadow-md hover:border-primary-200">
          <!-- Topic Card Header -->
          <div
            class="p-5 cursor-pointer"
            (click)="toggleTopic(topic.id)"
            [class.bg-slate-50]="selectedTopicId() === topic.id">
            <div class="flex flex-col sm:flex-row gap-5 items-start">
              <div class="flex-shrink-0 bg-primary-100 text-primary-600 p-3.5 rounded-lg">
                <svg [innerHTML]="getIconForCategory(topic.category)" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7"></svg>
              </div>
              <div class="flex-1">
                <div class="flex justify-between items-start">
                  <div>
                    <h2 class="text-lg font-bold text-slate-800">{{ topic.title }}</h2>
                    <p class="text-slate-600 mt-1 text-sm">{{ topic.description }}</p>
                  </div>
                  <div class="flex items-center gap-4 ml-4">
                     <span class="hidden sm:inline-flex items-center gap-x-1.5 rounded-md bg-slate-100 text-slate-700 px-2.5 py-1 text-xs font-medium">
                      {{ topic.lessons.length }} {{ topic.lessons.length === 1 ? 'Lesson' : 'Lessons' }}
                    </span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                         class="w-5 h-5 text-slate-400 transition-transform duration-300"
                         [class.rotate-180]="selectedTopicId() === topic.id">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Lessons List (Collapsible) -->
          <div
            class="grid grid-rows-[0fr] transition-all duration-300 ease-in-out"
            [class.grid-rows-[1fr]]="selectedTopicId() === topic.id">
            <div class="overflow-hidden">
              <div class="border-t border-slate-200 divide-y divide-slate-100">
                @for (lesson of topic.lessons; track lesson.id) {
                  <a [routerLink]="['/explanations/lesson', lesson.id]" class="block p-5 hover:bg-slate-50 transition-colors duration-200">
                    <div class="flex justify-between items-center gap-4">
                      <!-- Status Icon and Title -->
                      <div class="flex items-center gap-4">
                        @switch (lesson.completionStatus) {
                            @case ('Completed') {
                                <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-green-100 rounded-full">
                                    <svg class="w-4 h-4 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                </div>
                            }
                             @case ('In Progress') {
                                <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-blue-100 rounded-full">
                                    <div class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                                </div>
                            }
                            @case ('Not Started') {
                                <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-slate-100 rounded-full">
                                    <div class="w-2.5 h-2.5 bg-slate-400 rounded-full"></div>
                                </div>
                            }
                        }
                        <h3 class="font-medium text-slate-800">{{ lesson.title }}</h3>
                      </div>

                      <!-- Level and Arrow -->
                      <div class="flex items-center gap-4">
                        <span class="inline-block bg-primary-100 text-primary-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">{{lesson.level}}</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-slate-400">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                        </svg>
                      </div>
                    </div>
                  </a>
                } @empty {
                   <div class="text-center p-5 text-sm text-slate-500">
                      No lessons available for this topic yet.
                    </div>
                }
              </div>
            </div>
          </div>
        </div>
      }
      <!-- Pagination -->
      @if(totalPages() > 1) {
        <div class="mt-8">
            <app-pagination 
              [currentPage]="currentPage()" 
              [totalPages]="totalPages()"
              (pageChange)="onPageChange($event)">
            </app-pagination>
        </div>
      }
    </div>
  } @else {
    <div class="text-center py-16 max-w-5xl mx-auto">
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
      </svg>
      <h3 class="mt-2 text-sm font-semibold text-slate-800">No Topics Found</h3>
      <p class="mt-1 text-sm text-slate-500">No topics match the selected category. Please try another filter.</p>
    </div>
  }
</div>