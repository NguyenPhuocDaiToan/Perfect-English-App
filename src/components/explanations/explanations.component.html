<div class="bg-white">
  <!-- Hero Section -->
  <section class="bg-gradient-to-br from-primary-50 via-white to-blue-100">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center">
      <h1 class="text-4xl font-extrabold tracking-tight text-slate-900 sm:text-5xl">Learning Library</h1>
      <p class="mt-4 text-lg text-slate-600 max-w-2xl mx-auto">Explore clear explanations and examples for every area of English.</p>
    </div>
  </section>

  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Filter Bar -->
    <div class="border-b border-slate-200 mb-8">
      <nav class="-mb-px flex justify-center space-x-6 overflow-x-auto" aria-label="Tabs">
        @for (category of categories; track category) {
          <button
            (click)="selectCategory(category)"
            [class]="selectedCategory() === category
              ? 'border-primary-500 text-primary-600'
              : 'border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300'"
            class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
            {{ category }}
          </button>
        }
      </nav>
    </div>

    @if (status() === 'loading') {
      <div class="space-y-4 max-w-5xl mx-auto animate-pulse">
        @for (item of [1,2,3,4,5]; track item) {
          <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-5">
            <div class="flex flex-col sm:flex-row gap-5 items-start">
                <div class="flex-shrink-0 bg-slate-200 p-3.5 rounded-lg h-[52px] w-[52px]"></div>
                <div class="flex-1 w-full">
                  <div class="h-5 bg-slate-300 rounded w-1/3 mb-2"></div>
                  <div class="h-4 bg-slate-200 rounded w-2/3"></div>
                </div>
              </div>
          </div>
        }
      </div>
    } @else if (status() === 'loaded' && topics().length > 0) {
      <div class="space-y-4 max-w-5xl mx-auto">
        <!-- Loop through each topic -->
        @for (topic of topics(); track topic.id) {
          <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden transition-all duration-300 hover:shadow-md hover:border-primary-200">
            <!-- Topic Card Header -->
            <div
              class="p-5 cursor-pointer"
              (click)="toggleTopic(topic.id)"
              [class.bg-slate-50]="selectedTopicId() === topic.id">
              <div class="flex flex-col sm:flex-row gap-5 items-start">
                <div class="flex-shrink-0 bg-primary-100 text-primary-600 p-3.5 rounded-lg">
                  @switch (topic.category) {
                    @case ('Grammar') {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
                      </svg>
                    }
                    @case ('Vocabulary') {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                      </svg>
                    }
                    @case ('Writing') {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Z" />
                      </svg>
                    }
                    @case ('Speaking') {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 0 1 6 0v8.25a3 3 0 0 1-3 3Z" />
                      </svg>
                    }
                    @case ('Skills') {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.905 59.905 0 0 1 12 3.493a59.902 59.902 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-2.072-1.037m19.624 0l2.072-1.037M12 18.172l-6.235-3.428m12.47 0L12 18.172" />
                      </svg>
                    }
                    @default {
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.898 20.565l.223.894.223-.894a3.75 3.75 0 0 0-2.9-2.9l-.894-.223.894-.223a3.75 3.75 0 0 0 2.9 2.9l.223-.894.223.894a3.75 3.75 0 0 0 2.9 2.9l.894.223-.894.223a3.75 3.75 0 0 0-2.9 2.9Z" />
                      </svg>
                    }
                  }
                </div>
                <div class="flex-1">
                  <div class="flex justify-between items-start">
                    <div>
                      <h2 class="text-lg font-bold text-slate-800">{{ topic.title }}</h2>
                      <p class="text-slate-600 mt-1 text-sm">{{ topic.description }}</p>
                    </div>
                    <div class="flex items-center gap-4 ml-4">
                      <span class="hidden sm:inline-flex items-center gap-x-1.5 rounded-md bg-slate-100 text-slate-700 px-2.5 py-1 text-xs font-medium">
                        {{ topic.lessons.length }} {{ topic.lessons.length === 1 ? 'Lesson' : 'Lessons' }}
                      </span>
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
                          class="w-5 h-5 text-slate-400 transition-transform duration-300"
                          [class.rotate-180]="selectedTopicId() === topic.id">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Lessons List (Collapsible) -->
            <div
              class="grid grid-rows-[0fr] transition-all duration-300 ease-in-out"
              [class.grid-rows-[1fr]]="selectedTopicId() === topic.id">
              <div class="overflow-hidden">
                <div class="border-t border-slate-200 divide-y divide-slate-100">
                  @for (lesson of topic.lessons; track lesson.id) {
                    <a [routerLink]="['/explanations/lesson', lesson.id]" class="block p-5 hover:bg-slate-50 transition-colors duration-200">
                      <div class="flex justify-between items-center gap-4">
                        <!-- Status Icon and Title -->
                        <div class="flex items-center gap-4">
                          @switch (lesson.completionStatus) {
                              @case ('Completed') {
                                  <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-green-100 rounded-full">
                                      <svg class="w-4 h-4 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                                  </div>
                              }
                              @case ('In Progress') {
                                  <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-blue-100 rounded-full">
                                      <div class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                                  </div>
                              }
                              @case ('Not Started') {
                                  <div class="w-6 h-6 flex-shrink-0 flex items-center justify-center bg-slate-100 rounded-full">
                                      <div class="w-2.5 h-2.5 bg-slate-400 rounded-full"></div>
                                  </div>
                              }
                          }
                          <h3 class="font-medium text-slate-800">{{ lesson.title }}</h3>
                        </div>

                        <!-- Level and Arrow -->
                        <div class="flex items-center gap-4">
                          <span class="inline-block bg-primary-100 text-primary-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">{{lesson.level}}</span>
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-slate-400">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                          </svg>
                        </div>
                      </div>
                    </a>
                  } @empty {
                    <div class="text-center p-5 text-sm text-slate-500">
                        No lessons available for this topic yet.
                      </div>
                  }
                </div>
              </div>
            </div>
          </div>
        }
        <!-- Pagination -->
        @if(totalPages() > 1) {
          <div class="mt-8">
              <app-pagination 
                [currentPage]="currentPage()" 
                [totalPages]="totalPages()"
                (pageChange)="onPageChange($event)">
              </app-pagination>
          </div>
        }
      </div>
    } @else {
      <div class="text-center py-16 max-w-5xl mx-auto">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
        </svg>
        <h3 class="mt-2 text-sm font-semibold text-slate-800">No Topics Found</h3>
        <p class="mt-1 text-sm text-slate-500">No topics match the selected category. Please try another filter.</p>
      </div>
    }
  </div>
</div>
